{"version":3,"sources":["webpack:///./src/index.js"],"names":["console","log","NODE_TYPE","element","text","comment","DIRECTIVES","vm","data","test","test2","content","observe","Object","keys","forEach","defineReactive","key","val","defineProperty","enumerable","configurable","get","set","newVal","Dep","subs","sub","push","update","compile","node","regMoustache","regDirectives","nodeType","attrs","attributes","Array","from","nodeName","attr","directives","RegExp","$1","valueName","nodeValue","value","removeAttribute","addEventListener","e","target","trim","node2fragment","fragment","document","createDocumentFragment","child","firstChild","append","wrap","querySelector","appendChild"],"mappings":";;;;;;;;;;;;AAAAA,SAAQC,GAAR,CAAY,OAAZ;;AAEA,KAAMC,YAAY;AACdC,cAAS,CADK;AAEdC,WAAM,CAFQ;AAGdC,cAAS;AAHK,EAAlB;AAKA,KAAMC,aAAa,CACf,MADe,CAAnB;;AAIA,KAAMC,KAAK;AACPC,WAAM;AACFC,eAAM,MADJ;AAEFC,gBAAO,OAFL;AAGFC,kBAAS;AAHP;AADC,EAAX;;AAQAC,SAAQL,GAAGC,IAAX;;AAEAD,IAAGC,IAAH,CAAQC,IAAR,GAAe,QAAf;AACAF,IAAGC,IAAH,CAAQE,KAAR,GAAgB,KAAhB;;AAEA,UAASE,OAAT,CAAiBJ,IAAjB,EAAuB;AACnB,SAAI,CAACA,IAAD,IAAS,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAA7B,EAAuC;AACnC;AACH;;AAEDK,YAAOC,IAAP,CAAYN,IAAZ,EAAkBO,OAAlB,CAA0B,eAAO;AAC7BC,wBAAeR,IAAf,EAAqBS,GAArB,EAA0BT,KAAKS,GAAL,CAA1B;AACH,MAFD;AAGH;;AAED,UAASD,cAAT,CAAwBR,IAAxB,EAA8BS,GAA9B,EAAmCC,GAAnC,EAAwC;AACpCN,aAAQM,GAAR;;AAEAL,YAAOM,cAAP,CAAsBX,IAAtB,EAA4BS,GAA5B,EAAiC;AAC7BG,qBAAY,IADiB;AAE7BC,uBAAc,KAFe;AAG7BC,cAAK,eAAM;AACP,oBAAOJ,GAAP;AACH,UAL4B;AAM7BK,cAAK,qBAAU;AACXvB,qBAAQC,GAAR,CAAY,eAAZ,EAA6BiB,GAA7B,EAAkCM,MAAlC;AACAN,mBAAMM,MAAN;AACH;AAT4B,MAAjC;AAWH;;KAEKC,G;AACF,oBAAe;AAAA;;AACX,cAAKC,IAAL,GAAY,EAAZ;AACH;;;;gCAEOC,G,EAAK;AACT,kBAAKD,IAAL,CAAUE,IAAV,CAAeD,GAAf;AACH;;;kCAES;AACN,kBAAKD,IAAL,CAAUX,OAAV,CAAkB,eAAO;AACrBY,qBAAIE,MAAJ;AACH,cAFD;AAGH;;;;;;AAIL,UAASC,OAAT,CAAkBC,IAAlB,EAAwBxB,EAAxB,EAA4B;AACxB,SAAMyB,eAAe,eAArB;AACA,SAAMC,gBAAgB,aAAtB;AACA,SAAMC,WAAWH,KAAKG,QAAtB;;AAEA,SAAIA,YAAYhC,UAAUC,OAA1B,EAAmC;AAE/B,aAAMgC,QAAQJ,KAAKK,UAAnB;;AAEAC,eAAMC,IAAN,CAAWH,KAAX,EAAkB,gBAAQ;AACtB,iBAAMI,WAAWC,KAAKD,QAAtB;;AAEA,iBAAIN,cAAcxB,IAAd,CAAmB8B,QAAnB,CAAJ,EAAkC;AAE9B,qBAAME,aAAaC,OAAOC,EAA1B;;AAEA,qBAAIF,eAAe,MAAnB,EAA2B;AAAA;AACvB,6BAAMG,YAAYJ,KAAKK,SAAvB;AACAd,8BAAKe,KAAL,GAAavC,GAAGC,IAAH,CAAQoC,SAAR,CAAb;AACAb,8BAAKgB,eAAL,CAAqBR,QAArB;;AAEAR,8BAAKiB,gBAAL,CAAsB,OAAtB,EAA+B,aAAK;AAChCzC,gCAAGC,IAAH,CAAQoC,SAAR,IAAqBK,EAAEC,MAAF,CAASJ,KAA9B;;AAEA9C,qCAAQC,GAAR,CAAYM,EAAZ;AACH,0BAJD;AALuB;AAU1B;AACJ;AACJ,UAnBD;AAoBH;;AAED,SAAI2B,YAAYhC,UAAUE,IAA1B,EAAgC;AAE5B,aAAI4B,aAAavB,IAAb,CAAkBsB,KAAKc,SAAvB,CAAJ,EAAuC;AACnC,iBAAMC,QAASJ,OAAOC,EAAR,CAAYQ,IAAZ,EAAd;AACApB,kBAAKc,SAAL,GAAiBtC,GAAGC,IAAH,CAAQsC,KAAR,CAAjB;AACH;AACJ;AACJ;;AAED,UAASM,aAAT,CAAwBrB,IAAxB,EAA8B;AAC1B,SAAMsB,WAAWC,SAASC,sBAAT,EAAjB;AACA,SAAIC,cAAJ;;AAEA,YAAOA,QAAQzB,KAAK0B,UAApB,EAAgC;AAC5B3B,iBAAQ0B,KAAR,EAAejD,EAAf;AACA8C,kBAASK,MAAT,CAAgBF,KAAhB;AACH;;AAED,YAAOH,QAAP;AACH;;AAED,KAAMM,OAAOL,SAASM,aAAT,CAAuB,OAAvB,CAAb;AACA,KAAM7B,OAAOqB,cAAcO,IAAd,CAAb;AACA3D,SAAQC,GAAR,CAAY8B,IAAZ;AACA4B,MAAKE,WAAL,CAAiB9B,IAAjB,E","file":"index.js","sourcesContent":["console.log('Start');\n\nconst NODE_TYPE = {\n    element: 1,\n    text: 3,\n    comment: 8\n};\nconst DIRECTIVES = [\n    'bind'\n];\n\nconst vm = {\n    data: {\n        test: 'test',\n        test2: 'test2',\n        content: 'content'\n    }\n};\n\nobserve(vm.data);\n\nvm.data.test = 'notest';\nvm.data.test2 = 'hhh';\n\nfunction observe(data) {\n    if (!data || typeof data !== 'object') {\n        return;\n    }\n\n    Object.keys(data).forEach(key => {\n        defineReactive(data, key, data[key]);\n    });\n}\n\nfunction defineReactive(data, key, val) {\n    observe(val);\n\n    Object.defineProperty(data, key, {\n        enumerable: true,\n        configurable: false,\n        get: () => {\n            return val;\n        },\n        set: newVal => {\n            console.log('value changed', val, newVal);\n            val = newVal;\n        }\n    });\n}\n\nclass Dep {\n    constructor () {\n        this.subs = [];\n    }\n\n    addSub (sub) {\n        this.subs.push(sub);\n    }\n\n    notify () {\n        this.subs.forEach(sub => {\n            sub.update();\n        });\n    }\n}\n\n\nfunction compile (node, vm) {\n    const regMoustache = /\\{\\{(.*?)\\}\\}/;\n    const regDirectives = /g-([\\s\\S]+)/;\n    const nodeType = node.nodeType;\n    // console.log(nodeType);\n    if (nodeType == NODE_TYPE.element) {\n        // console.log(node);\n        const attrs = node.attributes;\n\n        Array.from(attrs, attr => {\n            const nodeName = attr.nodeName;\n\n            if (regDirectives.test(nodeName)) {\n                // const directives = nodeName.match(regDirectives);\n                const directives = RegExp.$1;\n\n                if (directives === 'bind') {\n                    const valueName = attr.nodeValue;\n                    node.value = vm.data[valueName];\n                    node.removeAttribute(nodeName);\n\n                    node.addEventListener('input', e => {\n                        vm.data[valueName] = e.target.value;\n\n                        console.log(vm);\n                    });\n                }\n            }\n        });\n    }\n\n    if (nodeType == NODE_TYPE.text) {\n        // console.log(node);\n        if (regMoustache.test(node.nodeValue)) {\n            const value = (RegExp.$1).trim();\n            node.nodeValue = vm.data[value];\n        }\n    }\n}\n\nfunction node2fragment (node) {\n    const fragment = document.createDocumentFragment();\n    let child;\n\n    while (child = node.firstChild) {\n        compile(child, vm);\n        fragment.append(child);\n    }\n\n    return fragment;\n}\n\nconst wrap = document.querySelector('.wrap');\nconst node = node2fragment(wrap);\nconsole.log(node);\nwrap.appendChild(node);\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}